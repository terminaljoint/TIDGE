<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TIGEN v2 - Advanced 3D Editor with Real Engine</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0b0d;
      color: #ececed;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    .editor-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    /* TOPBAR */
    .topbar {
      background: rgba(15, 16, 19, 0.98);
      border-bottom: 2px solid #00ff88;
      padding: 12px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      height: 55px;
      gap: 20px;
    }

    .topbar-logo {
      font-size: 20px;
      font-weight: bold;
      color: #00ff88;
    }

    .topbar-menus {
      display: flex;
      gap: 15px;
    }

    .menu-btn {
      background: none;
      border: none;
      color: #ececed;
      cursor: pointer;
      padding: 8px 12px;
      font-size: 12px;
      position: relative;
      transition: color 0.2s;
    }

    .menu-btn:hover {
      color: #00ff88;
    }

    .dropdown-menu {
      display: none;
      position: absolute;
      top: 35px;
      left: 0;
      background: rgba(20, 23, 28, 0.95);
      border: 1px solid #00ff88;
      border-radius: 4px;
      min-width: 180px;
      z-index: 1000;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);
    }

    .menu-btn:hover .dropdown-menu {
      display: block;
    }

    .dropdown-item {
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s;
      font-size: 12px;
      border-bottom: 1px solid rgba(0, 255, 136, 0.1);
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: rgba(0, 255, 136, 0.1);
    }

    .topbar-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .file-status {
      font-size: 11px;
      padding: 6px 12px;
      background: rgba(0, 255, 136, 0.1);
      border-radius: 3px;
      color: #00ff88;
    }

    .file-status.unsaved {
      background: rgba(255, 100, 80, 0.1);
      color: #ff6450;
    }

    .control-btn {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid #00ff88;
      color: #00ff88;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .control-btn:hover {
      background: rgba(0, 255, 136, 0.2);
      transform: scale(1.05);
    }

    /* MAIN CONTENT */
    .main-content {
      display: flex;
      flex: 1;
      overflow: hidden;
    }

    /* SIDEBARS */
    .sidebar {
      background: rgba(15, 16, 19, 0.9);
      border-right: 1px solid rgba(0, 255, 136, 0.2);
      padding: 12px;
      display: flex;
      flex-direction: column;
      overflow: auto;
      width: 250px;
      transition: width 0.3s;
    }

    .sidebar.collapsed {
      width: 40px;
    }

    .sidebar.collapsed > * {
      display: none;
    }

    .sidebar-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }

    .sidebar-tab {
      padding: 8px 12px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid transparent;
      color: #ececed;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .sidebar-tab.active {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    .sidebar-content {
      display: none;
      flex: 1;
      overflow-y: auto;
    }

    .sidebar-content.active {
      display: block;
    }

    .asset-item, .hierarchy-item {
      padding: 10px 8px;
      background: rgba(0, 255, 136, 0.05);
      border: 1px solid rgba(0, 255, 136, 0.1);
      border-radius: 3px;
      margin-bottom: 8px;
      cursor: pointer;
      font-size: 12px;
      transition: all 0.2s;
    }

    .asset-item:hover, .hierarchy-item:hover {
      background: rgba(0, 255, 136, 0.15);
      border-color: #00ff88;
    }

    .asset-item.category {
      font-weight: bold;
      background: rgba(0, 255, 136, 0.08);
      color: #00ff88;
    }

    /* VIEWPORT */
    .viewport-container {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(15, 16, 19, 0.9);
    }

    .viewport-toolbar {
      background: rgba(20, 23, 28, 0.9);
      border-bottom: 1px solid rgba(0, 255, 136, 0.2);
      padding: 10px;
      display: flex;
      gap: 15px;
      align-items: center;
      height: 45px;
      flex-wrap: wrap;
    }

    .toolbar-group {
      display: flex;
      gap: 5px;
      padding: 0 10px;
      border-right: 1px solid rgba(0, 255, 136, 0.2);
    }

    .tool-btn {
      background: rgba(0, 255, 136, 0.05);
      border: 1px solid rgba(0, 255, 136, 0.2);
      color: #ececed;
      padding: 6px 10px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .tool-btn:hover {
      background: rgba(0, 255, 136, 0.15);
      border-color: #00ff88;
    }

    .tool-btn.active {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    #viewport {
      flex: 1;
      background: linear-gradient(135deg, #0a0b0d 0%, #1a1d22 100%);
      border-radius: 0;
      cursor: crosshair;
    }

    .gizmo-controls {
      background: rgba(20, 23, 28, 0.9);
      border-top: 1px solid rgba(0, 255, 136, 0.2);
      padding: 10px;
      display: flex;
      gap: 5px;
      height: 40px;
      align-items: center;
    }

    .gizmo-btn {
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid #00ff88;
      color: #00ff88;
      padding: 6px 12px;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .gizmo-btn:hover, .gizmo-btn.active {
      background: rgba(0, 255, 136, 0.2);
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
    }

    /* RIGHT INSPECTOR */
    .inspector {
      background: rgba(15, 16, 19, 0.9);
      border-left: 1px solid rgba(0, 255, 136, 0.2);
      padding: 12px;
      width: 280px;
      display: flex;
      flex-direction: column;
      overflow: auto;
    }

    .inspector-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 15px;
    }

    .inspector-tab {
      padding: 8px 12px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid transparent;
      color: #ececed;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .inspector-tab.active {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    .inspector-content {
      display: none;
      flex: 1;
      overflow-y: auto;
    }

    .inspector-content.active {
      display: block;
    }

    .property-group {
      margin-bottom: 15px;
      background: rgba(0, 255, 136, 0.05);
      border: 1px solid rgba(0, 255, 136, 0.1);
      border-radius: 4px;
      overflow: hidden;
    }

    .property-header {
      padding: 10px 12px;
      background: rgba(0, 255, 136, 0.08);
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: bold;
      font-size: 12px;
      color: #00ff88;
      transition: background 0.2s;
    }

    .property-header:hover {
      background: rgba(0, 255, 136, 0.12);
    }

    .property-header.collapsed .arrow {
      transform: rotate(-90deg);
    }

    .arrow {
      transition: transform 0.2s;
    }

    .property-fields {
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .property-fields.hidden {
      display: none;
    }

    .property-input {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .property-input label {
      font-size: 11px;
      color: #888;
      font-weight: 500;
    }

    .property-input input {
      background: rgba(0, 255, 136, 0.05);
      border: 1px solid rgba(0, 255, 136, 0.2);
      color: #ececed;
      padding: 6px 8px;
      border-radius: 3px;
      font-size: 11px;
      transition: border-color 0.2s;
    }

    .property-input input:focus {
      border-color: #00ff88;
      outline: none;
    }

    /* BOTTOM CONSOLE */
    .console-container {
      background: rgba(15, 16, 19, 0.9);
      border-top: 1px solid rgba(0, 255, 136, 0.2);
      padding: 12px;
      height: 180px;
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    .console-tabs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
    }

    .console-tab {
      padding: 8px 12px;
      background: rgba(0, 255, 136, 0.1);
      border: 1px solid transparent;
      color: #ececed;
      border-radius: 3px;
      cursor: pointer;
      font-size: 11px;
      transition: all 0.2s;
    }

    .console-tab.active {
      background: rgba(0, 255, 136, 0.2);
      border-color: #00ff88;
      color: #00ff88;
    }

    .console-output {
      display: none;
      flex: 1;
      background: rgba(10, 11, 13, 0.5);
      border: 1px solid rgba(0, 255, 136, 0.1);
      border-radius: 3px;
      padding: 10px;
      overflow-y: auto;
      font-family: 'Monaco', 'Courier New', monospace;
      font-size: 11px;
    }

    .console-output.active {
      display: block;
    }

    .console-message {
      margin-bottom: 6px;
      padding: 4px 8px;
      border-left: 3px solid #00ff88;
      padding-left: 10px;
    }

    .console-message.error {
      border-left-color: #ff6450;
      color: #ff6450;
    }

    .console-message.warning {
      border-left-color: #ffb800;
      color: #ffb800;
    }

    /* UTILITIES */
    .collapse-btn {
      background: none;
      border: none;
      color: #888;
      cursor: pointer;
      padding: 5px 8px;
      font-size: 16px;
      transition: color 0.2s;
    }

    .collapse-btn:hover {
      color: #00ff88;
    }

    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: rgba(0, 255, 136, 0.05);
    }

    ::-webkit-scrollbar-thumb {
      background: rgba(0, 255, 136, 0.2);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 255, 136, 0.4);
    }
  </style>
</head>
<body>
  <div class="editor-container">
    <!-- TOPBAR -->
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-logo">üéÆ TIGEN v2</div>
        <input type="text" placeholder="Scene name..." id="sceneTitle" style="background: rgba(0,255,136,0.1); border: 1px solid #00ff88; color: #00ff88; padding: 6px 8px; border-radius: 3px; width: 200px; font-size: 11px;">
        <div class="file-status" id="fileStatus">‚óè Saved</div>
      </div>

      <div class="topbar-menus">
        <button class="menu-btn">üìÅ File
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="newScene()">New Scene</div>
            <div class="dropdown-item" onclick="saveScene()">Save Scene (Ctrl+S)</div>
            <div class="dropdown-item" onclick="loadScene()">Load Scene</div>
            <div class="dropdown-item" onclick="exportScene()">Export</div>
          </div>
        </button>

        <button class="menu-btn">‚úèÔ∏è Edit
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="undoAction()">Undo</div>
            <div class="dropdown-item" onclick="redoAction()">Redo</div>
            <div class="dropdown-item">Duplicate</div>
            <div class="dropdown-item">Delete</div>
          </div>
        </button>

        <button class="menu-btn">üëÅÔ∏è View
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="setViewAngle('front')">Front View</div>
            <div class="dropdown-item" onclick="setViewAngle('top')">Top View</div>
            <div class="dropdown-item" onclick="setViewAngle('iso')">Isometric</div>
            <div class="dropdown-item" onclick="toggleGrid()">Toggle Grid</div>
          </div>
        </button>

        <button class="menu-btn">üì¶ GameObject
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="addPrimitive('box')">Add Cube</div>
            <div class="dropdown-item" onclick="addPrimitive('sphere')">Add Sphere</div>
            <div class="dropdown-item" onclick="addLight('point')">Add Light</div>
            <div class="dropdown-item" onclick="addCamera()">Add Camera</div>
          </div>
        </button>

        <button class="menu-btn">üîß Tools
          <div class="dropdown-menu">
            <div class="dropdown-item" onclick="addPhysics()">Add Physics</div>
            <div class="dropdown-item" onclick="addParticles()">Add Particles</div>
            <div class="dropdown-item" onclick="addScript()">Add Script</div>
            <div class="dropdown-item" onclick="openSettings()">Settings</div>
          </div>
        </button>
      </div>

      <div class="topbar-right">
        <button class="control-btn" onclick="playScene()">‚ñ∂ Play</button>
        <button class="control-btn" onclick="pauseScene()">‚è∏ Pause</button>
        <button class="control-btn" onclick="stopScene()">‚èπ Stop</button>
      </div>
    </div>

    <!-- MAIN CONTENT -->
    <div class="main-content">
      <!-- LEFT SIDEBAR -->
      <div class="sidebar" id="sidebarLeft">
        <button class="collapse-btn" onclick="toggleLeftPanel()" style="align-self: flex-end;">‚àí</button>
        <div class="sidebar-tabs">
          <button class="sidebar-tab active" onclick="switchSidebarTab(event, 'assets')">Assets</button>
          <button class="sidebar-tab" onclick="switchSidebarTab(event, 'hierarchy')">Hierarchy</button>
          <button class="sidebar-tab" onclick="switchSidebarTab(event, 'search')">Search</button>
        </div>

        <!-- ASSETS TAB -->
        <div id="assets" class="sidebar-content active">
          <div class="asset-item category">üé® Primitives</div>
          <div class="asset-item" onclick="addPrimitive('box')">Cube</div>
          <div class="asset-item" onclick="addPrimitive('sphere')">Sphere</div>
          <div class="asset-item" onclick="addPrimitive('cylinder')">Cylinder</div>
          <div class="asset-item" onclick="addPrimitive('plane')">Plane</div>
          <div class="asset-item" onclick="addPrimitive('pyramid')">Pyramid</div>
          <div class="asset-item" onclick="addPrimitive('torus')">Torus</div>

          <div class="asset-item category" style="margin-top: 15px;">üí° Lights</div>
          <div class="asset-item" onclick="addLight('directional')">Directional Light</div>
          <div class="asset-item" onclick="addLight('point')">Point Light</div>
          <div class="asset-item" onclick="addLight('spot')">Spot Light</div>
          <div class="asset-item" onclick="addLight('ambient')">Ambient Light</div>

          <div class="asset-item category" style="margin-top: 15px;">‚ú® Effects</div>
          <div class="asset-item" onclick="addParticles()">Particle System</div>
          <div class="asset-item" onclick="addAudio()">Audio Source</div>
          <div class="asset-item" onclick="addCamera()">Camera</div>
          <div class="asset-item" onclick="addScript()">Script</div>
        </div>

        <!-- HIERARCHY TAB -->
        <div id="hierarchy" class="sidebar-content">
          <div style="font-size: 11px; color: #888; margin-bottom: 10px;">Scene Objects:</div>
          <div id="hierarchyList"></div>
        </div>

        <!-- SEARCH TAB -->
        <div id="search" class="sidebar-content">
          <input type="text" id="searchInput" placeholder="Search objects..." style="background: rgba(0,255,136,0.05); border: 1px solid rgba(0,255,136,0.2); color: #ececed; padding: 8px; border-radius: 3px; width: 100%; margin-bottom: 10px; font-size: 11px;">
          <div id="searchResults" style="font-size: 11px; color: #888;">No results</div>
        </div>
      </div>

      <!-- VIEWPORT -->
      <div class="viewport-container">
        <div class="viewport-toolbar">
          <div class="toolbar-group">
            <button class="tool-btn" onclick="setTool('move')">‚ÜîÔ∏è Move</button>
            <button class="tool-btn" onclick="setTool('rotate')">‚Üª Rotate</button>
            <button class="tool-btn" onclick="setTool('scale')">‚äû Scale</button>
          </div>

          <div class="toolbar-group">
            <button class="tool-btn" onclick="toggleGrid()">üìä Grid</button>
            <button class="tool-btn" onclick="toggleGizmos()">üìê Gizmos</button>
            <button class="tool-btn" onclick="toggleWireframe()">üï∏Ô∏è Wireframe</button>
          </div>

          <div class="toolbar-group">
            <button class="tool-btn" onclick="setViewAngle('front')">Front</button>
            <button class="tool-btn" onclick="setViewAngle('top')">Top</button>
            <button class="tool-btn" onclick="setViewAngle('iso')">Iso</button>
          </div>

          <div style="margin-left: auto; font-size: 11px; color: #00ff88;">
            <span id="fpsCounter">FPS: 0</span> | <span id="objectCounter">Objects: 0</span> | <span id="facesCounter">Faces: 0</span>
          </div>
        </div>

        <canvas id="viewport" width="1600" height="900"></canvas>

        <div class="gizmo-controls">
          <button class="gizmo-btn active" onclick="setGizmo('move')">Move</button>
          <button class="gizmo-btn" onclick="setGizmo('rotate')">Rotate</button>
          <button class="gizmo-btn" onclick="setGizmo('scale')">Scale</button>
          <button class="gizmo-btn" onclick="setGizmo('center')">Center</button>
        </div>
      </div>

      <!-- RIGHT INSPECTOR -->
      <div class="inspector" id="inspector">
        <button class="collapse-btn" onclick="toggleRightPanel()" style="align-self: flex-end;">‚àí</button>
        <div class="inspector-tabs">
          <button class="inspector-tab active" onclick="switchInspectorTab(event, 'properties')">Properties</button>
          <button class="inspector-tab" onclick="switchInspectorTab(event, 'materials')">Materials</button>
          <button class="inspector-tab" onclick="switchInspectorTab(event, 'physics')">Physics</button>
        </div>

        <!-- PROPERTIES TAB -->
        <div id="properties" class="inspector-content active">
          <div id="propertiesContent"></div>
        </div>

        <!-- MATERIALS TAB -->
        <div id="materials" class="inspector-content">
          <div style="color: #888; font-size: 11px;">Select an object to edit materials</div>
        </div>

        <!-- PHYSICS TAB -->
        <div id="physics" class="inspector-content">
          <div style="color: #888; font-size: 11px;">Select an object to edit physics</div>
        </div>
      </div>
    </div>

    <!-- BOTTOM CONSOLE -->
    <div class="console-container">
      <div class="console-tabs">
        <button class="console-tab active" onclick="switchConsoleTab(event, 'console')">Console</button>
        <button class="console-tab" onclick="switchConsoleTab(event, 'output')">Output</button>
        <button class="console-tab" onclick="switchConsoleTab(event, 'profiler')">Profiler</button>
      </div>

      <div id="console" class="console-output active"></div>
      <div id="output" class="console-output"></div>
      <div id="profiler" class="console-output"></div>
    </div>
  </div>

  <script src="engine.js"></script>
  <script src="logic-system.js"></script>

  <script>
    // Global engine state
    let engine = {
      scene: null,
      renderer: null,
      gameLoop: null,
      input: null,
      selectedEntity: null,
      isPlaying: false,
      isPaused: false,
      currentTool: 'move',
      currentGizmo: 'move'
    };

    // Initialize engine on page load
    window.addEventListener('load', () => {
      initializeEngine();
      setupEventListeners();
      startRenderLoop();
    });

    function initializeEngine() {
      const canvas = document.getElementById('viewport');
      canvas.width = window.innerWidth - 530;
      canvas.height = window.innerHeight - 280;

      engine.renderer = new Renderer(canvas);
      engine.scene = engine.renderer.createScene('Main Scene');
      engine.gameLoop = new GameLoop(60);
      engine.input = new InputManager();

      // Create default scene
      const cube = engine.scene.createEntity('Cube');
      const mesh = cube.addComponent(Mesh);
      mesh.setGeometry('box');
      mesh.setColor(0, 1, 0.5);

      const sphere = engine.scene.createEntity('Sphere');
      sphere.transform.setPosition(3, 0, 0);
      const sphereMesh = sphere.addComponent(Mesh);
      sphereMesh.setGeometry('sphere');
      sphereMesh.setColor(1, 0, 0.5);

      const light = engine.scene.createEntity('MainLight');
      light.transform.setPosition(5, 5, 5);
      light.addComponent(Light);

      updateHierarchy();
      updateStats();
    }

    function startRenderLoop() {
      engine.gameLoop.setCallback((deltaTime) => {
        if (engine.isPlaying && !engine.isPaused) {
          engine.scene.update(deltaTime);
        }
        engine.renderer.render(deltaTime);
        updateStats();
      });
      engine.gameLoop.start();
    }

    function setupEventListeners() {
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 's') {
          e.preventDefault();
          saveScene();
        }
        if (e.key === ' ') {
          e.preventDefault();
          playScene();
        }
      });

      window.addEventListener('resize', () => {
        const canvas = document.getElementById('viewport');
        canvas.width = window.innerWidth - 530;
        canvas.height = window.innerHeight - 280;
      });
    }

    // UI Functions
    function switchSidebarTab(e, tabName) {
      document.querySelectorAll('.sidebar-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('#assets, #hierarchy, #search').forEach(s => s.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    function switchInspectorTab(e, tabName) {
      document.querySelectorAll('.inspector-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.inspector-content').forEach(c => c.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    function switchConsoleTab(e, tabName) {
      document.querySelectorAll('.console-tab').forEach(t => t.classList.remove('active'));
      document.querySelectorAll('.console-output').forEach(c => c.classList.remove('active'));
      e.target.classList.add('active');
      document.getElementById(tabName).classList.add('active');
    }

    function toggleLeftPanel() {
      document.getElementById('sidebarLeft').classList.toggle('collapsed');
    }

    function toggleRightPanel() {
      document.getElementById('inspector').classList.toggle('collapsed');
    }

    // Scene functions
    function newScene() {
      engine.scene.entities = [];
      engine.scene.rootEntities = [];
      engine.selectedEntity = null;
      updateHierarchy();
      logConsole('New scene created');
    }

    function saveScene() {
      const data = JSON.stringify(engine.scene.serialize(), null, 2);
      localStorage.setItem('tigen_scene', data);
      document.getElementById('fileStatus').textContent = '‚óè Saved';
      document.getElementById('fileStatus').className = 'file-status';
      logConsole('Scene saved successfully');
    }

    function loadScene() {
      const data = localStorage.getItem('tigen_scene');
      if (data) {
        logConsole('Scene loaded');
      } else {
        logConsole('No saved scene found', 'error');
      }
    }

    function exportScene() {
      const data = engine.scene.serialize();
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'scene.json';
      a.click();
      logConsole('Scene exported');
    }

    function playScene() {
      engine.isPlaying = true;
      engine.isPaused = false;
      logConsole('‚ñ∂ Play - Scene running');
    }

    function pauseScene() {
      engine.isPaused = !engine.isPaused;
      logConsole(engine.isPaused ? '‚è∏ Paused' : '‚ñ∂ Resumed');
    }

    function stopScene() {
      engine.isPlaying = false;
      engine.isPaused = false;
      logConsole('‚èπ Stop - Scene halted');
    }

    // Object functions
    function addPrimitive(type) {
      const entity = engine.scene.createEntity(`${type.charAt(0).toUpperCase() + type.slice(1)}_${engine.scene.entities.length}`);
      const mesh = entity.addComponent(Mesh);
      mesh.setGeometry(type);
      mesh.setColor(Math.random(), Math.random(), Math.random());
      updateHierarchy();
      markUnsaved();
      logConsole(`Added ${type} to scene`);
    }

    function addLight(type) {
      const entity = engine.scene.createEntity(`Light_${type}`);
      const light = entity.addComponent(Light);
      light.type = type;
      updateHierarchy();
      markUnsaved();
      logConsole(`Added ${type} light`);
    }

    function addCamera() {
      const entity = engine.scene.createEntity('Camera');
      entity.addComponent(Camera);
      updateHierarchy();
      logConsole('Added camera');
    }

    function addPhysics() {
      if (engine.selectedEntity) {
        engine.selectedEntity.addComponent(Physics);
        logConsole(`Added physics to ${engine.selectedEntity.name}`);
        markUnsaved();
      } else {
        logConsole('Select an object first', 'error');
      }
    }

    function addParticles() {
      const entity = engine.scene.createEntity('ParticleSystem');
      entity.addComponent(ParticleSystem);
      updateHierarchy();
      logConsole('Added particle system');
    }

    function addAudio() {
      const entity = engine.scene.createEntity('AudioSource');
      entity.addComponent(AudioSource);
      updateHierarchy();
      logConsole('Added audio source');
    }

    function addScript() {
      if (engine.selectedEntity) {
        engine.selectedEntity.addScript(Script);
        logConsole(`Added script to ${engine.selectedEntity.name}`);
      } else {
        logConsole('Select an object first', 'error');
      }
    }

    // Tools
    function setTool(tool) {
      engine.currentTool = tool;
      document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
      logConsole(`Tool changed to: ${tool}`);
    }

    function setGizmo(gizmo) {
      engine.currentGizmo = gizmo;
      document.querySelectorAll('.gizmo-btn').forEach(b => b.classList.remove('active'));
      event.target.classList.add('active');
    }

    function toggleGrid() {
      logConsole('Grid toggled');
    }

    function toggleGizmos() {
      logConsole('Gizmos toggled');
    }

    function toggleWireframe() {
      logConsole('Wireframe toggled');
    }

    function setViewAngle(angle) {
      logConsole(`View changed to: ${angle}`);
    }

    function undoAction() {
      logConsole('Undo action');
    }

    function redoAction() {
      logConsole('Redo action');
    }

    function openSettings() {
      logConsole('Settings opened');
    }

    // Helper functions
    function updateHierarchy() {
      const hierarchyList = document.getElementById('hierarchyList');
      hierarchyList.innerHTML = '';
      engine.scene.entities.forEach(entity => {
        const item = document.createElement('div');
        item.className = 'hierarchy-item';
        item.textContent = entity.name;
        item.onclick = () => selectEntity(entity);
        hierarchyList.appendChild(item);
      });
    }

    function selectEntity(entity) {
      engine.selectedEntity = entity;
      updateProperties();
      logConsole(`Selected: ${entity.name}`);
    }

    function updateProperties() {
      const content = document.getElementById('propertiesContent');
      if (!engine.selectedEntity) {
        content.innerHTML = '<div style="color: #888; font-size: 11px;">No object selected</div>';
        return;
      }

      const entity = engine.selectedEntity;
      const transform = entity.transform;

      content.innerHTML = `
        <div class="property-group">
          <div class="property-header" onclick="this.parentElement.querySelector('.property-fields').classList.toggle('hidden')">
            <span>Transform</span>
            <span class="arrow">‚ñº</span>
          </div>
          <div class="property-fields">
            <div class="property-input">
              <label>Position X</label>
              <input type="number" value="${transform.position.x.toFixed(2)}" onchange="engine.selectedEntity.transform.setPosition(parseFloat(this.value), engine.selectedEntity.transform.position.y, engine.selectedEntity.transform.position.z); markUnsaved();">
            </div>
            <div class="property-input">
              <label>Position Y</label>
              <input type="number" value="${transform.position.y.toFixed(2)}" onchange="engine.selectedEntity.transform.setPosition(engine.selectedEntity.transform.position.x, parseFloat(this.value), engine.selectedEntity.transform.position.z); markUnsaved();">
            </div>
            <div class="property-input">
              <label>Position Z</label>
              <input type="number" value="${transform.position.z.toFixed(2)}" onchange="engine.selectedEntity.transform.setPosition(engine.selectedEntity.transform.position.x, engine.selectedEntity.transform.position.y, parseFloat(this.value)); markUnsaved();">
            </div>
            <div class="property-input">
              <label>Scale</label>
              <input type="number" value="${transform.scale.x.toFixed(2)}" onchange="engine.selectedEntity.transform.setScale(parseFloat(this.value), parseFloat(this.value), parseFloat(this.value)); markUnsaved();">
            </div>
          </div>
        </div>
      `;
    }

    function updateStats() {
      document.getElementById('fpsCounter').textContent = `FPS: ${engine.gameLoop.fps}`;
      document.getElementById('objectCounter').textContent = `Objects: ${engine.scene.entities.length}`;
      const faceCount = engine.scene.entities.reduce((sum, e) => {
        return sum + (e.components.mesh && e.components.mesh.geometry ? e.components.mesh.geometry.getFaceCount() : 0);
      }, 0);
      document.getElementById('facesCounter').textContent = `Faces: ${faceCount}`;
    }

    function markUnsaved() {
      document.getElementById('fileStatus').textContent = '‚óè Unsaved';
      document.getElementById('fileStatus').className = 'file-status unsaved';
    }

    function logConsole(message, type = 'log') {
      const console = document.getElementById('console');
      const msg = document.createElement('div');
      msg.className = `console-message ${type}`;
      msg.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      console.appendChild(msg);
      console.scrollTop = console.scrollHeight;
    }

    // Make functions available globally
    window.engine = engine;
    window.switchSidebarTab = switchSidebarTab;
    window.switchInspectorTab = switchInspectorTab;
    window.switchConsoleTab = switchConsoleTab;
    window.toggleLeftPanel = toggleLeftPanel;
    window.toggleRightPanel = toggleRightPanel;
    window.newScene = newScene;
    window.saveScene = saveScene;
    window.loadScene = loadScene;
    window.exportScene = exportScene;
    window.playScene = playScene;
    window.pauseScene = pauseScene;
    window.stopScene = stopScene;
    window.addPrimitive = addPrimitive;
    window.addLight = addLight;
    window.addCamera = addCamera;
    window.addPhysics = addPhysics;
    window.addParticles = addParticles;
    window.addAudio = addAudio;
    window.addScript = addScript;
    window.setTool = setTool;
    window.setGizmo = setGizmo;
    window.toggleGrid = toggleGrid;
    window.toggleGizmos = toggleGizmos;
    window.toggleWireframe = toggleWireframe;
    window.setViewAngle = setViewAngle;
    window.undoAction = undoAction;
    window.redoAction = redoAction;
    window.openSettings = openSettings;
    window.logConsole = logConsole;
    window.markUnsaved = markUnsaved;
  </script>
</body>
</html>
